<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Simple Tracking Image Detector</title>
</head>
<body>

  <h1>Tracking Image Detector</h1>

  <p>Paste HTML below:</p>

  <textarea id="htmlInput" rows="15" cols="100"></textarea>
  <br><br>

  <button onclick="analyze()">Analyze</button>

  <h2>Results</h2>
  <div id="results"></div>

  <script>
    const domainBlacklist = [
      "facebook.com/tr",
      "connect.facebook.net",
      "googleadservices.com/pagead",
      "googlesyndication.com",
      "px.ads.linkedin.com",
      "linkedin.com/collect",
      "analytics.tiktok.com",
      "tr.snapchat.com",
      "doubleclick.net"
    ];

    const pathKeywords = [
      "/pixel", "/track", "/tracking", "/collect",
      "/conversion", "/click", "/view",
      "tid=", "pixel_id=", "guid="
    ];

    function analyze() {
      const html = document.getElementById("htmlInput").value;
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");
      const images = doc.querySelectorAll("img");

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      images.forEach((img, index) => {
        const src = img.getAttribute("src") || "";
        let reasons = [];

        // 1x1 pixel rule
        const w = img.getAttribute("width");
        const h = img.getAttribute("height");
        if ((w === "1" || w === "0") && (h === "1" || h === "0")) {
          reasons.push("1x1 pixel");
        }

        // Domain blacklist
        domainBlacklist.forEach(domain => {
          if (src.toLowerCase().includes(domain)) {
            reasons.push("Domain blacklist match");
          }
        });

        // Path keywords
        pathKeywords.forEach(keyword => {
          if (src.toLowerCase().includes(keyword)) {
            reasons.push("Tracking keyword match");
          }
        });

        // 3+ query parameters
        if (src.includes("?")) {
          const query = src.split("?")[1];
          const params = query.split("&");
          if (params.length >= 3) {
            reasons.push("3+ query parameters");
          }
        }

        // Noscript or head placement
        if (img.closest("noscript")) {
          reasons.push("Inside <noscript>");
        }
        if (img.closest("head")) {
          reasons.push("Inside <head>");
        }

        const resultText = document.createElement("p");

        if (reasons.length > 0) {
          resultText.innerHTML =
            "<strong>Tracking:</strong> " + src +
            "<br>Reasons: " + reasons.join(", ");
        } else {
          resultText.innerHTML =
            "<strong>Normal:</strong> " + src;
        }

        resultsDiv.appendChild(resultText);
        resultsDiv.appendChild(document.createElement("hr"));
      });

      if (images.length === 0) {
        resultsDiv.innerHTML = "No images found.";
      }
    }
  </script>

</body>
</html>
